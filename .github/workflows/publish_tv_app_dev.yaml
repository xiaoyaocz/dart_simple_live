name: app-build-action
#æ¨é€Tagæ—¶è§¦å‘
on:
    push:
        tags:
            - "dev_tv_v*"
jobs:
    build-tv:
        runs-on: macos-latest
        permissions:
            contents: write
        steps:
            #ç­¾å‡ºä»£ç 
            - uses: actions/checkout@v4
              with:
                  ref: dev

            #APKç­¾åè®¾ç½®
            - name: Download Android keystore
              id: android_tv_keystore
              uses: timheuer/base64-to-file@v1.2
              with:
                  fileName: keystore.jks
                  encodedString: ${{ secrets.TV_KEYSTORE_BASE64 }}
            - name: Create key.properties
              run: |
                  echo "storeFile=${{ steps.android_tv_keystore.outputs.filePath }}" > simple_live_tv_app/android/key.properties
                  echo "storePassword=${{ secrets.TV_STORE_PASSWORD }}" >> simple_live_tv_app/android/key.properties
                  echo "keyPassword=${{ secrets.TV_KEY_PASSWORD }}" >> simple_live_tv_app/android/key.properties
                  echo "keyAlias=${{ secrets.TV_KEY_ALIAS }}" >> simple_live_tv_app/android/key.properties

            # è®¾ç½®JAVAç¯å¢ƒ
            - uses: actions/setup-java@v4
              with:
                  distribution: "zulu"
                  java-version: "17"
                  cache: "gradle"

            #è®¾ç½®Flutter
            - name: Flutter action
              uses: subosito/flutter-action@v2
              with:
                  flutter-version: "3.38.x"
                  cache: true

            #æ›´æ–°Flutterçš„packages
            - name: Restore packages
              run: |
                  cd simple_live_tv_app
                  flutter pub get

            #æ‰“åŒ…APK
            - name: Build APK
              run: |
                  cd simple_live_tv_app
                  flutter build apk --release --split-per-abi

            #ä¸Šä¼ APKè‡³Artifacts
            - name: Upload APK to Artifacts
              uses: actions/upload-artifact@v4
              with:
                  name: android_tv
                  path: |
                      simple_live_tv_app/build/app/outputs/flutter-apk/app-armeabi-v7a-release.apk
                      simple_live_tv_app/build/app/outputs/flutter-apk/app-arm64-v8a-release.apk
                      simple_live_tv_app/build/app/outputs/flutter-apk/app-x86_64-release.apk
            #å®Œæˆ
            - run: echo "ğŸ This job's status is ${{ job.status }}."
