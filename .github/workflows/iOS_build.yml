# .github/workflows/ios_build.yml
name: iOS_build

on:
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  build:
    name: Build iOS App
    runs-on: macos-15

    steps:
    - name: Checkout code
      uses: actions/checkout@v4 # æ£€å‡ºä½ çš„ä»£ç ä»“åº“

      # è®¾ç½®Flutter
    - name: Flutter action
      uses: subosito/flutter-action@v2
      with:
        flutter-version: '3.29.3'
        cache: true 

    - name: Get Flutter dependencies
      run: 
           cd simple_live_app
           flutter pub get # ä¸‹è½½é¡¹ç›®ä¾èµ–
           
   # è®¾ç½®flutter_distributorç¯å¢ƒ
    - name: Install flutter_distributor
      run: dart pub global activate flutter_distributor

   #æ‰“åŒ…iOS
    - name: Build IPA
      run: |
         cd simple_live_app
         flutter build ios --release --no-codesign

   #åˆ›å»ºæœªç­¾åipa
    - name: Create IPA
      run: |
        cd simple_live_app
        mkdir build/ios/iphoneos/Payload
        cp -R build/ios/iphoneos/Runner.app build/ios/iphoneos/Payload/Runner.app
        cd build/ios/iphoneos/
        zip -q -r ios_no_sign.ipa Payload
        cd ../../..

    # ä¸Šä¼ IPAè‡³Artifacts
    - name: Upload IPA to Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: ios
        path: |
          simple_live_app/build/ios/iphoneos/ios_no_sign.ipa
             
    #å®Œæˆ
    - run: echo "ğŸ This job's status is ${{ job.status }}."
